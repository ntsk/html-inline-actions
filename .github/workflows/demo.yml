name: Demo

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  demo:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '24'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build action
        run: npm run bundle

      - name: Test with single file path
        uses: ./
        with:
          path: 'examples/index.html'
          prefix: 'single-'

      - name: Test with wildcard pattern
        uses: ./
        with:
          path: 'examples/*.html'
          prefix: 'wildcard-'

      - name: Test with directory path
        uses: ./
        with:
          path: 'examples/'
          prefix: 'dir-'

      - name: Test with multiline paths
        uses: ./
        with:
          path: |
            examples/index.html
            examples/about.html
          prefix: 'multiline-'

      - name: Upload results
        uses: actions/upload-artifact@v4
        with:
          name: inlined-html
          path: |
            examples/single-*.html
            examples/wildcard-*.html
            examples/dir-*.html
            examples/multiline-*.html

      - name: Show result files content
        run: |
          echo "=== Original index.html ==="
          cat examples/index.html
          echo ""
          echo "=== Original about.html ==="
          cat examples/about.html
          echo ""
          echo "=== Single file result ==="
          cat examples/single-index.html
          echo ""
          echo "=== Wildcard pattern result ==="
          cat examples/wildcard-index.html
          echo ""
          echo "=== Directory result ==="
          cat examples/dir-index.html
          echo ""
          echo "=== Multiline paths result (index) ==="
          cat examples/multiline-index.html
          echo ""
          echo "=== Multiline paths result (about) ==="
          cat examples/multiline-about.html
